---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# UnivRankR

<!-- badges: start -->
The goal of UnivRankR is to provide advanced Fuzzy Multi-Criteria Decision Making (MCDM) methods including VIKOR, TOPSIS, and WASPAS, along with state-of-the-art visualizations. It supports both data-driven (Entropy) and expert-driven (Best-Worst Method) weighting schemes.
<!-- badges: end -->

The goal of UnivRankR is to ...

## Installation

You can install the development version of UnivRankR from [GitHub](https://github.com/) with:

```{r}
# install.packages("devtools")
devtools::install_github("MarekDejaUJ/UnivRankR")
```

## Example

This example demonstrates how to process raw survey data, apply fuzzy logic, and rank alternatives using three different MCDM methods.

### 1. Load Data

We use the built-in dataset `mcdm_raw_data`.

```{r example}
library(UnivRankR)
data("mcdm_raw_data", package = "UnivRankR")
head(mcdm_raw_data)
```

### 2. Define Measurement Model

We define how the raw survey items map to the four decision criteria: Cost, Quality, Delivery, and Sustainability.

```{r syntax}
mcdm_syntax <- "
  Cost           =~ cost_raw_mat + cost_labor;
  Quality        =~ qual_durability + qual_finish + qual_defects + qual_ux;
  Delivery       =~ del_time_avg + del_reliability + del_tracking;
  Sustainability =~ sus_co2 + sus_waste + sus_material + sus_social
"
```

### 3. Prepare Data

We process the raw data by aggregating the 20 expert responses into scores for the 4 Suppliers (Alternatives), scaling them to Saaty's 1-9 scale, and fuzzifying them.

```{r prepare}
d_mat <- prepare_mcdm_data(
  data = mcdm_raw_data, 
  syntax = mcdm_syntax, 
  alternative_col = "Alternative" # Aggregate by this column
)

# The result is a 4x12 matrix (4 Suppliers x 3 Fuzzy Values per 4 Criteria)
print(d_mat)
print(attr(d_mat, "criteria_names"))

# Calculate the crisp weights (one per criterion) for later use
w_entropy <- calculate_entropy_weights(d_mat)
print(round(w_entropy, 3))

# Expand weights to match fuzzy matrix structure
w_expanded <- rep(w_entropy, each = 3)

# Define BWM parameters for later use
bwm_best_vec  <- c(8, 1, 3, 2) 
bwm_worst_vec <- c(1, 8, 4, 6)
```

### 4. Run Analysis (BWM Weights)

We run the analysis using the expert's Best-Worst Method (BWM) preferences.

```{r analysis_bwm}
crit_types <- c("min", "max", "max", "max")

# 1. Fuzzy VIKOR (Compromise Solution)
res_vikor <- fuzzy_vikor(
  decision_mat = d_mat,
  criteria_types = crit_types,
  bwm_best = bwm_best_vec,
  bwm_worst = bwm_worst_vec
)

# 2. Fuzzy TOPSIS (Distance to Ideal)
res_topsis <- fuzzy_topsis(
  decision_mat = d_mat,
  criteria_types = crit_types,
  bwm_best = bwm_best_vec,
  bwm_worst = bwm_worst_vec
)

# 3. Fuzzy WASPAS (Weighted Aggregation)
res_waspas <- fuzzy_waspas(
  decision_mat = d_mat,
  criteria_types = crit_types,
  bwm_best = bwm_best_vec,
  bwm_worst = bwm_worst_vec
)

# Print BWM outputs
print(res_vikor)
print(res_topsis)
print(res_waspas)
```

### 5. Plot BWM Results

We visualize the results using three distinct maps: **Performance-Risk (VIKOR)**, **Efficiency (TOPSIS)**, and **Robustness (WASPAS)**.

```{r plots, fig.width=8, fig.height=5}
plot(res_vikor)
plot(res_topsis)
plot(res_waspas)
```

### 6. Run Analysis with Entropy (Data-Driven)

We now run the same analysis using objective Entropy weights derived purely from the data variance. Note that we pass `weights` and remove the `bwm_` arguments.

```{r analysis_entropy}
### --- A. Fuzzy VIKOR ---
res_vikor_ent <- fuzzy_vikor(
  decision_mat = d_mat,
  criteria_types = crit_types,
  weights = w_expanded
)

### --- B. Fuzzy TOPSIS ---
res_topsis_ent <- fuzzy_topsis(
  decision_mat = d_mat,
  criteria_types = crit_types,
  weights = w_expanded
)

### --- C. Fuzzy WASPAS ---
res_waspas_ent <- fuzzy_waspas(
  decision_mat = d_mat,
  criteria_types = crit_types,
  weights = w_expanded
)

# Print Entropy outputs
print(res_vikor_ent)
print(res_topsis_ent)
print(res_waspas_ent)
```

### 7. Compare Rankings

Finally, we compare how the ranking changes depending on whether we use Expert opinion (BWM) or Data variance (Entropy).

```{r comparison}
comparison <- data.frame(
  Supplier = rownames(d_mat),
  Rank_BWM = res_vikor$results$Ranking,          # From Section 4
  Rank_Entropy = res_vikor_ent$results$Ranking   # From Section 6
)
print(comparison)
```
